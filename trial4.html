<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIN-AI Chat Interface</title>
    <style>
        :root {
            --primary-color: #4a7c3a;
            --secondary-color: #e8f5e9;
            --text-color: #333;
            --light-text: #fff;
            --border-radius: 20px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        header {
            background: linear-gradient(to right, #4a7c3a, #6ba353);
            color: var(--light-text);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .header-controls {
            display: flex;
            gap: 15px;
        }
        
        .header-controls button {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 1000px;
            width: 100%;
            margin: 0 auto;
            padding: 20px;
        }
        
        .welcome-screen, .chat-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            gap: 20px;
            padding: 20px;
        }
        
        .welcome-screen {
            background-color: var(--primary-color);
            color: var(--light-text);
            border-radius: var(--border-radius);
        }
        
        .logo-icon {
            width: 80px;
            height: 80px;
            background-color: #3a5f2d;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .logo-icon svg {
            width: 50px;
            height: 50px;
            fill: var(--light-text);
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 20px;
        }
        
        .welcome-text {
            font-size: 1.2rem;
            max-width: 600px;
            margin-bottom: 20px;
        }
        
        .input-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-top: 30px;
        }
        
        input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 1px solid #ddd;
            border-radius: 30px;
            font-size: 1rem;
            outline: none;
        }
        
        .send-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background-color: var(--primary-color);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        .send-btn svg {
            width: 18px;
            height: 18px;
            fill: white;
        }
        
        .chat-messages {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            overflow-y: auto;
            padding: 20px 0;
            flex: 1;
        }
        
        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
        }
        
        .user-message {
            align-self: flex-end;
            background-color: var(--primary-color);
            color: var(--light-text);
        }
        
        .ai-message {
            align-self: flex-start;
            background-color: #e9e9e9;
        }
        
        .chat-input {
            position: sticky;
            bottom: 0;
            width: 100%;
            padding: 15px 0;
            background-color: #f5f5f5;
        }
        
        .typing-indicator {
            display: flex;
            padding: 12px 16px;
            gap: 5px;
            align-self: flex-start;
            background-color: #e9e9e9;
            border-radius: 18px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #888;
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typingAnimation {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-5px);
            }
        }
        
        .chat-screen {
            display: none;
        }
        
        .api-key-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .api-key-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
        }
        
        .api-key-content h2 {
            margin-bottom: 20px;
        }
        
        .api-key-content p {
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .api-key-content input {
            width: 100%;
            margin-bottom: 20px;
        }
        
        .api-key-content button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        
        .settings-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            color: white;
            font-size: 20px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .message {
                max-width: 90%;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">FIN-AI</div>
        <div class="header-controls">
            <button id="search-btn">üîç</button>
            <button id="menu-btn">‚ò∞</button>
        </div>
    </header>
    
    <main>
        <!-- Welcome Screen -->
        <div class="welcome-screen" id="welcome-screen">
            <button class="settings-btn" id="settings-btn">‚öôÔ∏è</button>
            <h1>Introducing FIN-AI</h1>
            <div class="logo-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                    <circle cx="8.5" cy="10.5" r="2"/>
                    <circle cx="15.5" cy="10.5" r="2"/>
                    <path d="M12 16c-1.48 0-2.75-.81-3.45-2h6.9c-.7 1.19-1.97 2-3.45 2z"/>
                </svg>
            </div>
            <p class="welcome-text">
                Meet Fin-AI, your personal AI-powered assistant, ready to help with all your financial queries. 
                Just ask, and let Fin-AI handle the rest!
            </p>
            <div class="input-container">
                <input type="text" id="welcome-input" placeholder="Ask me anything">
                <button class="send-btn" id="welcome-send">
                    <svg viewBox="0 0 24 24">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Chat Screen -->
        <div class="chat-screen" id="chat-screen">
            <div class="chat-messages" id="chat-messages">
                <div class="message ai-message">
                    How can I assist you with your financial questions today?
                </div>
                <!-- Messages will be added here -->
            </div>
            
            <div class="chat-input">
                <div class="input-container">
                    <input type="text" id="chat-input" placeholder="Type your message...">
                    <button class="send-btn" id="chat-send">
                        <svg viewBox="0 0 24 24">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </main>
    
    <!-- API Key Modal -->
    <div class="api-key-modal" id="api-key-modal">
        <div class="api-key-content">
            <h2>Connect to OpenAI</h2>
            <p>To make FIN-AI work with real AI capabilities, please enter your OpenAI API key. Your key will be stored locally in your browser and never sent to our servers.</p>
            <p><small>If you don't have an API key, you can get one from <a href="https://platform.openai.com/account/api-keys" target="_blank">OpenAI's website</a>.</small></p>
            <input type="password" id="api-key-input" placeholder="Enter your OpenAI API key">
            <button id="save-api-key">Save Key</button>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const welcomeScreen = document.getElementById('welcome-screen');
            const chatScreen = document.getElementById('chat-screen');
            const welcomeInput = document.getElementById('welcome-input');
            const welcomeSend = document.getElementById('welcome-send');
            const chatInput = document.getElementById('chat-input');
            const chatSend = document.getElementById('chat-send');
            const chatMessages = document.getElementById('chat-messages');
            const apiKeyModal = document.getElementById('api-key-modal');
            const apiKeyInput = document.getElementById('api-key-input');
            const saveApiKeyBtn = document.getElementById('save-api-key');
            const settingsBtn = document.getElementById('settings-btn');
            
            // Check if API key is stored in localStorage
            let apiKey = localStorage.getItem('openai-api-key');
            
            // If API key exists, hide the modal
            if (apiKey) {
                apiKeyModal.style.display = 'none';
            }
            
            // Settings button click event
            settingsBtn.addEventListener('click', function() {
                apiKeyModal.style.display = 'flex';
            });
            
            // Save API key button click event
            saveApiKeyBtn.addEventListener('click', function() {
                const key = apiKeyInput.value.trim();
                if (key) {
                    localStorage.setItem('openai-api-key', key);
                    apiKey = key;
                    apiKeyModal.style.display = 'none';
                }
            });
            
            // Chat history storage
            let conversationHistory = [
                { role: "system", content: "You are FIN-AI, a helpful financial assistant specialized in personal finance management, investing, budgeting, debt management, and financial planning. Provide concise, accurate, and helpful information about financial topics. Keep responses brief and focused on financial matters. For the user's first question, introduce yourself briefly as FIN-AI before answering." }
            ];
            
            // Function to get response from OpenAI API
            async function getAIResponse(message) {
                // Check if API key exists
                if (!apiKey) {
                    apiKeyModal.style.display = 'flex';
                    return "Please enter your OpenAI API key to enable AI responses.";
                }
                
                try {
                    // Add user message to conversation history
                    conversationHistory.push({ role: "user", content: message });
                    
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: "gpt-3.5-turbo",
                            messages: conversationHistory,
                            max_tokens: 500,
                            temperature: 0.7
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.error) {
                        console.error('OpenAI API Error:', data.error);
                        return "There was an error with the AI service. Please check your API key or try again later.";
                    }
                    
                    const aiResponse = data.choices[0].message.content;
                    
                    // Add AI response to conversation history
                    conversationHistory.push({ role: "assistant", content: aiResponse });
                    
                    return aiResponse;
                } catch (error) {
                    console.error('Error calling OpenAI API:', error);
                    return "I'm having trouble connecting to my AI services. Please check your internet connection or try again later.";
                }
            }
            
            // Fallback response generator for when API is not available
            function generateLocalResponse(message) {
                message = message.toLowerCase();
                
                if (message.includes('hello') || message.includes('hi')) {
                    return "Hello! I'm FIN-AI, your financial assistant. How can I help with your financial needs today?";
                } else if (message.includes('budget') || message.includes('spending')) {
                    return "Creating a budget is essential for financial health. The 50/30/20 rule suggests allocating 50% of income to needs, 30% to wants, and 20% to savings and debt repayment. Would you like specific budgeting advice?";
                } else if (message.includes('invest') || message.includes('stock')) {
                    return "When it comes to investing, diversification is key. A balanced portfolio typically includes a mix of stocks, bonds, and other assets based on your risk tolerance and financial goals. What type of investments are you considering?";
                } else if (message.includes('save') || message.includes('saving')) {
                    return "For emergency savings, aim to save 3-6 months of expenses. Beyond that, consider saving for specific goals like retirement, education, or major purchases. High-yield savings accounts or certificates of deposit can be good options for short-term goals.";
                } else if (message.includes('debt') || message.includes('loan')) {
                    return "When managing debt, prioritize high-interest debt first while making minimum payments on others. The avalanche method (paying highest interest first) saves money long-term, while the snowball method (paying smallest balances first) provides psychological wins.";
                } else if (message.includes('credit score') || message.includes('credit')) {
                    return "Your credit score is influenced by payment history (35%), amounts owed (30%), length of credit history (15%), new credit (10%), and credit mix (10%). Paying bills on time and keeping credit utilization below 30% are the most effective ways to improve your score.";
                } else if (message.includes('thank')) {
                    return "You're welcome! I'm here anytime you need financial guidance or information. Is there anything else I can help with today?";
                } else {
                    return "I'm here to help with all your financial questions. Could you provide more details about what financial information you're looking for?";
                }
            }
            
            // Function to transition from welcome to chat screen
            async function transitionToChat(message) {
                // Add user message to chat
                addMessage(message, 'user');
                
                // Hide welcome screen and show chat screen
                welcomeScreen.style.display = 'none';
                chatScreen.style.display = 'flex';
                
                // Show typing indicator
                showTypingIndicator();
                
                try {
                    // Try to get response from OpenAI
                    const response = await getAIResponse(message);
                    
                    // Remove typing indicator and show response
                    removeTypingIndicator();
                    addMessage(response, 'ai');
                } catch (error) {
                    console.error('Error:', error);
                    
                    // If API call fails, use local response generator
                    const fallbackResponse = generateLocalResponse(message);
                    removeTypingIndicator();
                    addMessage(fallbackResponse, 'ai');
                }
                
                // Focus on chat input
                chatInput.focus();
            }
            
            // Function to add a new message to the chat
            function addMessage(text, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message');
                messageDiv.classList.add(sender === 'user' ? 'user-message' : 'ai-message');
                
                // Process text for formatting
                const formattedText = formatText(text);
                messageDiv.innerHTML = formattedText;
                
                chatMessages.appendChild(messageDiv);
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Function to format text with simple markdown
            function formatText(text) {
                // Replace ** bold ** with <strong>bold</strong>
                text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                
                // Replace * italic * with <em>italic</em>
                text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
                
                // Replace new lines with <br>
                text = text.replace(/\n/g, '<br>');
                
                return text;
            }
            
            // Function to show typing indicator
            function showTypingIndicator() {
                const typingDiv = document.createElement('div');
                typingDiv.classList.add('typing-indicator');
                typingDiv.id = 'typing-indicator';
                
                for (let i = 0; i < 3; i++) {
                    const dot = document.createElement('div');
                    dot.classList.add('typing-dot');
                    typingDiv.appendChild(dot);
                }
                
                chatMessages.appendChild(typingDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Function to remove typing indicator
            function removeTypingIndicator() {
                const typingIndicator = document.getElementById('typing-indicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }
            
            // Event listeners for the welcome screen
            welcomeSend.addEventListener('click', function() {
                const message = welcomeInput.value.trim();
                if (message) {
                    transitionToChat(message);
                    welcomeInput.value = '';
                }
            });
            
            welcomeInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const message = welcomeInput.value.trim();
                    if (message) {
                        transitionToChat(message);
                        welcomeInput.value = '';
                    }
                }
            });
            
            // Event listeners for the chat screen
            chatSend.addEventListener('click', function() {
                sendChatMessage();
            });
            
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });
            
            // Function to handle sending a chat message
            async function sendChatMessage() {
                const message = chatInput.value.trim();
                if (message) {
                    addMessage(message, 'user');
                    chatInput.value = '';
                    
                    // Show typing indicator
                    showTypingIndicator();
                    
                    try {
                        // Try to get response from OpenAI
                        const response = await getAIResponse(message);
                        
                        // Remove typing indicator and show response
                        removeTypingIndicator();
                        addMessage(response, 'ai');
                    } catch (error) {
                        console.error('Error:', error);
                        
                        // If API call fails, use local response generator
                        const fallbackResponse = generateLocalResponse(message);
                        removeTypingIndicator();
                        addMessage(fallbackResponse, 'ai');
                    }
                }
            }
            
            // Sample financial data for demonstration
            const financialData = {
                user: {
                    name: "Demo User",
                    balance: 12580.45,
                    income: 5200,
                    expenses: 3800,
                    savings: 1400,
                    investmentReturn: 8.2
                },
                transactions: [
                    { date: "2025-04-05", category: "Groceries", amount: -125.36 },
                    { date: "2025-04-04", category: "Salary", amount: 2600.00 },
                    { date: "2025-04-03", category: "Restaurant", amount: -58.92 },
                    { date: "2025-04-02", category: "Utilities", amount: -145.80 },
                    { date: "2025-04-01", category: "Transport", amount: -84.50 }
                ],
                investments: {
                    stocks: 8500,
                    bonds: 4200,
                    crypto: 1800
                }
            };
            
            // Function to inject financial data into conversations
            function injectFinancialContext(message) {
                message = message.toLowerCase();
                
                // Add relevant financial data context to the conversation history
                if (message.includes('balance') || message.includes('account')) {
                    conversationHistory.push({ 
                        role: "system", 
                        content: `User's current account balance is $${financialData.user.balance}.` 
                    });
                }
                
                if (message.includes('spend') || message.includes('transaction') || message.includes('expense')) {
                    let transactionInfo = "Recent transactions: ";
                    financialData.transactions.forEach(t => {
                        transactionInfo += `${t.date}: ${t.category} $${t.amount}. `;
                    });
                    conversationHistory.push({ role: "system", content: transactionInfo });
                }
                
                if (message.includes('invest') || message.includes('stock') || message.includes('portfolio')) {
                    conversationHistory.push({ 
                        role: "system", 
                        content: `User's investments: $${financialData.investments.stocks} in stocks, $${financialData.investments.bonds} in bonds, $${financialData.investments.crypto} in cryptocurrency. Overall return rate: ${financialData.user.investmentReturn}%.` 
                    });
                }
                
                if (message.includes('budget') || message.includes('income') || message.includes('save')) {
                    conversationHistory.push({ 
                        role: "system", 
                        content: `Monthly income: $${financialData.user.income}. Monthly expenses: $${financialData.user.expenses}. Monthly savings: $${financialData.user.savings}.` 
                    });
                }
            }
        });
    </script>
</body>
</html>